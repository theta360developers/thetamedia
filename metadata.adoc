== metadata
To handle orientation (top/bottom correction), the RICOH THETA also adds
https://en.wikipedia.org/wiki/Exif[EXIF] and
https://developers.google.com/streetview/spherical-metadata[XMP]
data to the images.

THETA images can be exported to XMP format using the
official application and edited in other tools such as those
https://helpx.adobe.com/photoshop/using/metadata-notes.html[developed by Adobe].

There are a number of free tools and libraries to access the metadata.

* http://www.sno.phy.queensu.ca/~phil/exiftool/[ExifTool by Phil Harvey]
* http://u88.n24.queensu.ca/~bogdan/[ExifToolGUI]
* https://www.thexifer.net/[the eXif.er]

image::img/metadata/exif-data.png[role="thumb" title="metadata viewed with ExifToolGUI"]

You can immediately see useful data in the metadata tags. Many sites, including
Facebook will
https://facebook360.fb.com/editing-360-photos-injecting-metadata/[look]
for a *Make* of *RICOH* and a *Model* of *RICOH THETA S*. You can
use the metadata *Make* and *Model* to see if the image file your
application is opening is a 360 image.

IMPORTANT: The THETA image must also be in a ratio of 2:1. Your application should
check for this ratio in case the image was edited incorrectly in post-processing.

Clicking on the Xmp tab, we'll now get to the real exciting data.

image::img/metadata/xmp_data.png[role="thumb" title="Exciting THETA XMP Data"]

For starters, you can check for the *ProjectionType* of *equirectangular*.
Your application can easily identify an equirectangular image this way.

Below this, you can see the *PoseHeadingDegrees*, *PosePitchDegrees*, and
*PoseRollDegrees*. The THETA camera has internal sensors to get the
heading, pitch and roll.

CAUTION: The user of your application may have edited the image and deleted
the metadata from the image. The solution is to review their post-processing
workflow and then inspect the metadata manually.

Metadata can be injected into a 360 image that has lost the data by graphic
editing tools. Programming libraries can do this, or you can use exiftool
in a script.

 exiftool -ProjectionType="equirectangular" photo.jpg

Here's an
http://lists.theta360.guide/t/getting-360-images-to-work-after-resize-exif-technique/1066[article]
on getting the images to work after resizing the image by
copying the original XMP data and copying over the resized image.

NOTE: The article above is not the recommended technique as the THETA desktop application can
now add XMP data into the JPEG image. This can be used with tools like Adobe Photoshop

image::img/metadata/xmp_theta_app.png[role="thumb" title="Official THETA Desktop Application saving XMP data"]

After the correction, the XMP data for pitch and roll will be zeroed out.

image::img/metadata/zero-out.png[role="thumb" title="Pitch and Roll are zeroed out by the THETA app"]

IMPORTANT: The orientation of images on an application like Google Streetview will be incorrect
if the user applied correction to some images and not others. They need to apply the adjustment
to all images.

### Libraries

* https://github.com/mayanklahiri/easyexif[easyexif]: C++ EXIF parsing library by http://lahiri.me/[Mayank Lahiri]
* http://www.exiv2.org/[Exiv2]: C++ metadata library and tools by Andreas Huggel
* https://www.codeproject.com/Articles/36342/ExifLib-A-Fast-Exif-Data-Extractor-for-NET[ExifLib] -
A fast EXIF data extractor for .NET by Simon McKenzie



### End User Tools

These tools are for digital artists and support the XMP tags. Many other tools
support the metadata tags.

* http://www.flamingpear.com/flexify-2.html[Flexify 2] Photoshop plug-in
* https://helpx.adobe.com/premiere-pro/how-to/vr-video.html[Adobe Premiere Pro with VR support]
